# Уведомления об обновлении статуса заявки

{% hint style="info" %}
Для подключения webhook обновления статуса заявки, обратитесь к вашему менеджеру в IMSHOP.IO
{% endhint %}

## Описание

Каждый раз, когда меняется статус заявки, IMSHOP.IO отправляет уведомления в систему управления заказами

## Запрос

### Описание запроса

* **`ticketId`** - идентификатор ранее созданной заявки
* **`orderId`** - идентификатор заказа
* **`storeId`** - идентификатор магазина
* **`staffId`** - идентификатор сотрудника, инициировавшего смену статуса
* **`status`** - новый статус
* **`step`** - id нового шага, если заявка перешла в следующий шаг, или заявка завершилась по таймауту шага
* **`comment`** - комментарий от сотрудника
* **`metadata`** - дополнительные данные
  * **`timestamp`** - unix таймштамп смены статуса
  * **`deliveryTrackingNumber`** - трекинговый номер заказа после передачи в доставку \(опционально\)
  * **`deliveryOrderId`** - номер накладной транспортной компании \(опционально\)
  * **`unavailableItems`** - товары, которых не было в наличии, из-за которых не был сформирован заказ:
    * **`configurationId`** - идентификатор торгового предложения
    * **`quantity`** - количество отсутствующего товара

### Пример запроса

```javascript
{
    "ticketId": "rsp-12345",
    "orderId": "a7878969"
    "storeId": "1456",
    "staffId": "12393",
    "status": "done",
    "step": null,
    "comment": null,
    "metadata": {
        "timestamp": "1591207746"
    }
}
```

## Ответ

Сервер должен ответить любым сообщением с HTTP статусом 200, или пустым ответом со статусом 204

## Список возможных статусов

Ниже приведен список возможных статусов для каждого типа заявки

* **`prepare`** - сборка заказа
  * **`done`** - заказ собран
  * **`failed`** - заказ не собран
  * **`partiallyDone`** - собран частично \(если частичная сборка разрешена\)
* **`ship`** - передача заказа в доставку
  * **`shipped`** - отправлен
  * **`failed`** - не отправлен
  * **`partiallyShipped`** - отправлен частично
* **`receive`** - получение заказа для выдачи в магазине
  * **`received`** - получен
  * **`failed`** - не принят
  * **`returned`** - возвращен обратно в службу доставки / магазин отправки
  * **`partiallyReturned`** - возвращен обратно в службу доставки / магазин отправки
  * **`handedOver`** - выдан покупателю \(выкуплен\)
  * **`partiallyHandedOver`** - выдан частично
  * **`notHandedOver`** - отказ покупателя от получения заказа \(полностью не выкуплен\)
* **`release`** - расформировать собранный заказ
  * **`released`** - расформирован
  * **`failed`** - не расформирован
* **`cancel`** - отмена ранее созданной заявки
  * **`cancelled`** - успешно отменен
* все возможные статусы
  * **`not-accepted`** - заявка не была принята в работу в течение **`shouldBeAcceptedInTimeout`** секунд
  * **`timeout`** - не удалось завершить один из шагов заявки \(прошло больше **`timeout`** секунд, отведенных на шаг\)
  * **`advance`** - переход на другой шаг

