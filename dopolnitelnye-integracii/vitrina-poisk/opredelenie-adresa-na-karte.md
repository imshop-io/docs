---
description: В разработке!!!
---

# Определение адреса на карте

{% hint style="danger" %}
**IMSHOP Retail Protocol (IRP)** является объектом интеллектуальной собственности ООО «АЙ ЭМ СОЛЮШНЗ» (IMSHOP) и защищён как объект авторского права. Свидетельство о депонировании произведения № 023-014461 от 16 января 2023 г. подтверждает исключительные права ООО «АЙ ЭМ СОЛЮШНЗ» на данные технологии.

IMSHOP Retail Protocol создан по заказу ООО «АЙ ЭМ СОЛЮШНЗ». Использование IMSHOP Retail Protocol допустимо только при взаимодействии с ООО "АЙ ЭМ СОЛЮШНЗ" и наличии действующего лицензионного договора. Более подробно можно ознакомиться [здесь](../../api-license.md).
{% endhint %}

![](<../../.gitbook/assets/image (5) (1).png>)

{% hint style="info" %}
Запрос отправляется после того как определился адрес пользователя в через наш сервис подсказок.
{% endhint %}

{% hint style="info" %}
Фильтр каталога по магазинам будет работать только если подключен **фид остатков**, в котором  **id оутлетов совпадает с id присылаемых точек в этом ендпоинте**. &#x20;
{% endhint %}

{% hint style="info" %}
Для возможности оформить заказ с включенным функционалом адреса на карте в ендпоинте доставок корзины также должны быть корректные типы **type** доставок (**pickup** и **delivery**),  а также должны совпадать id точек для самовывоза.
{% endhint %}

## Формат запроса и пример

### Пример

```json
{
          "country": "RU",
          "coords": {
            "latitude": "55.75407485208535",
            "longitude": "37.62039307504892"
          },
          "city": "Москва",
          "address": "",
          "userData": {},
          "addressData": {
            "beltwayHit": null,
            "fias_code": null,
            "settlementKladr": null,
            "cityKladr": "7700000000000",
            "kladr": "7700000000015750011",
            "value": "г Москва, Красная пл, д 9",
            "building": null,
            "streetKladr": "77000000000157500",
            "regionKladr": "7700000000000",
            "areaKladr": null,
            "area": null,
            "fias": "b385b772-74f9-4743-924f-878d9b32bd7d",
            "house": "9",
            "street": "Красная",
            "streetFias": "8e39d017-db1c-413f-ae77-5f0d3b9e7ee9",
            "settlementWithType": null,
            "beltwayDistance": null,
            "settlement": null,
            "houseKladr": "7700000000015750011",
            "fiasCode": null,
            "lon": "37.6198822",
            "houseFias": "b385b772-74f9-4743-924f-878d9b32bd7d",
            "lat": "55.7536639",
            "fias_id": "b385b772-74f9-4743-924f-878d9b32bd7d",
            "settlementFias": null,
            "areaFias": null,
            "zip": "109012",
            "apt": null,
            "city": "Москва",
            "region": "Москва",
            "regionFias": "0c5b2444-70a0-4932-980c-b4dc0d3f02b5",
            "city_kladr": "7700000000000",
            "cityFias": "0c5b2444-70a0-4932-980c-b4dc0d3f02b5"
          },
          "installId": "00650000-0008-0000-ac5d-e021b623c9b7",
          "externalUserId": "72fc0000-f564-400d-a00e-000000a0409f"
        }
```

### Описание формата

* **`coords`** - объект координат пользователя
  * **`latitude`** - широта
  * **`longitude`** - долгота
* **`city`** - город
* **`addressData`** - объект информации о геокодированной точке на карте
  * **`fias_id`** — [ФИАС](https://www.alta.ru/fias)-код адреса (идентификатор адреса)
  * **`settlementWithType`** — улица с типом
  * **`areaKladr`** — [Классификатор адресов Российской Федерации](https://www.alta.ru/fias/), определяющий район
  * **`street`**— название улицы
  * **`fias_code`** — не заполняется, используйте **`fias_id`**
  * **`area`** — район в регионе
  * **`beltwayHit`** — внутри кольцевой ( IN_MKAD - на территории МКАД, OUT\__MKAD - за территорией МКАД)
  * **`houseFias`**— **не ориентируйтесь на это поле** [ФИАС](https://www.alta.ru/fias), определяющий конкретный дом, по умолчанию **`null`**, ситуативно [DaData ](https://dadata.ru/)может передавать данное поле заполненным
  * **`cityKladr`**— [Классификатор адресов Российской Федерации](https://www.alta.ru/fias/), определяющий город
  * **`city`**— название города
  * **`house`**— номер дома
  * **`settlementKladr`** — [Классификатор адресов Российской Федерации](https://www.alta.ru/fias/), определяющий населенный пункт
  * **`lon`**— долгота
  * **`lat`**— широта&#x20;
  * **`beltwayDistance`** — расстояние от кольцевой в км (только если заполнен **`beltwayHit`**)
  * **`settlementFias`** — [ФИАС](https://www.alta.ru/fias)-код населенного пункта
  * **`settlement`** — населенный пункт
  * **`zip`**— индекс дома
  * **`streetFias`**— [ФИАС](https://www.alta.ru/fias) определяющий улицу
  * **`city_kladr`**— [Классификатор адресов Российской Федерации](https://www.alta.ru/fias/), определяющий город
  * **`regionFias`**— [ФИАС](https://www.alta.ru/fias) определяющий регион
  * **`regionKladr`**— [Классификатор адресов Российской Федерации](https://www.alta.ru/fias/), определяющий регион
  * **`streetKladr`**— [Классификатор адресов Российской Федерации](https://www.alta.ru/fias/), определяющий  улицу
  * **`areaFias`** — [ФИАС](https://www.alta.ru/fias)-код района
  * **`cityFias`**— [ФИАС](https://www.alta.ru/fias) города&#x20;
  * **`value`**— адрес полностью
  * **`fias`**— [ФИАС](https://www.alta.ru/fias) города и улицы
  * **`region`**— регион
  * **`houseKladr`**— **не ориентируйтесь на это поле** [Классификатор адресов Российской Федерации](https://www.alta.ru/fias/), определяющий конкретный дом, по умолчанию **`null`**, ситуативно [DaData ](https://dadata.ru/)может передавать данное поле заполненным
  * **`apt`**— номер квартиры
  * **`kladr`** — [Классификатор адресов Российской Федерации](https://www.alta.ru/fias/), определяющий  город и улицу

## Формат ответа и пример

### Пример

```json
{
  "deliveries": [
    {
      "deliveryLocation": {
        "id": "1",
        "title": "Официальный магазин 1",
        "address": "Адрес магазина 1",
        "city": "Москва",
        "lat": "55.82103459558953",
        "lon": "37.622106949294164",
        "price": 0,
        "min": 0,
        "mapIcon": "https://media.discordapp.net/attachments/797048356953260083/1086305227587723354/image.png"
      },
      "locations": [
        {
          "id": "1",
          "title": "Официальный магазин 1",
          "address": "Адрес магазина 1",
          "city": "Москва",
          "lat": "55.82103459558953",
          "lon": "37.622106949294164",
          "price": 0,
          "min": 0,
          "mapIcon": "https://media.discordapp.net/attachments/797048356953260083/1086305227587723354/image.png"
        },
        {
          "id": "2",
          "title": "Официальный магазин 2",
          "address": "Адрес магазина 2",
          "city": "Москва",
          "lat": "55.82029929504126",
          "lon": "37.61991819151923",
          "price": 0,
          "min": 0,
          "mapIcon": "https://media.discordapp.net/attachments/797048356953260083/1086305227587723354/image.png"
        },
        {
          "id": "3",
          "title": "Официальный магазин 3",
          "address": "Адрес магазина 3",
          "city": "Москва",
          "lat": "55.8195398293086",
          "lon": "37.621055407817195",
          "price": 0,
          "min": 0,
          "mapIcon": "https://media.discordapp.net/attachments/797048356953260083/1086305227587723354/image.png"
        },
        {
          "id": "4",
          "title": "Официальный магазин 4",
          "address": "Адрес магазина 4",
          "city": "Москва",
          "lat": "55.82100450114413",
          "lon": "37.61952123769003",
          "price": 0,
          "min": 0,
          "mapIcon": "https://media.discordapp.net/attachments/797048356953260083/1086305227587723354/image.png"
        }
      ]
    }
  ]
}
```

### Описание формата

* **`locations`** — список ПВЗ (МАССИВ ОБЪЕКТОВ ТОЧЕК ПВЗ) если рядом с данными координатами нет магазинов то пустой (также используется для фильтрации каталога если подключен фид остатков)
  * :exclamation:**`id`** — идентификатор самовывоза, строка **(обязательное поле)**
  * :exclamation:**`title`** — название, строка **(обязательное поле)**
  * :exclamation:**`address`** — адрес, строка **(обязательное поле)**
  * :exclamation:**`city`** — город, строка **(обязательное поле)**
  * :exclamation:**`lat`** — широта для отображения на карте, строка **(обязательное поле)**
  * :exclamation:**`lon`** — долгота для отображения на карте, строка **(обязательное поле)**
  * **`mapIcon`** —  ссылка на кастомную иконку точки
* **`deliveryLocation`** - Магазин из которого будет осуществляться доставка на выбранный адрес и по которому будет отфильтрован каталог (если доставка на адрес невозможна то вернуть null) (1 ОБЪЕКТ ОДНОЙ ТОЧКИ ПВЗ)
  * :exclamation:**`id`** — идентификатор самовывоза, строка **(обязательное поле)**
  * :exclamation:**`lon`** — долгота для отображения на карте, строка **(обязательное поле)**
  * :exclamation:**`lat`** — широта для отображения на карте, строка **(обязательное поле)**
  * :exclamation:**`city`** — город, строка **(обязательное поле)**
  * :exclamation:**`address`** — адрес, строка **(обязательное поле)**
  * :exclamation:**`title`** — название, строка **(обязательное поле)**
