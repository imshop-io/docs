# Фид наличия для ElasticSearch

## Описание

Передача отдельного фида с наличием товаров в интернет магазине / рознице, позволит IMSHOP.IO отображать в приложении актуальное наличие товаров, а также фильтровать товары по наличию в конкретном магазине.

{% hint style="info" %}
Помимо фидов наличия, IMSHOP.IO также поддерживает [API / webhook для проверки наличия товаров в реальном времени](../../dopolnitelnye-integracii/kartochka-tovara/proverka-nalichiya-tovara.md) в момент изменения корзины, просмотра карточки товара и оформлении заказа. Фид наличия не является заменой api проверки наличия, но фид остатков позволит фильтровать товары по текущему наличию товара в магазине, и отображать различный набор товаров и цен в зависимости от региона покупателя.
{% endhint %}

## Подключение

Для настройки синхронизации наличия товаров, необходимо передать следующие данные вашему личному менеджеру в IMSHOP.IO:

* URL, по которому можно скачать каталог товаров в описанном формате
* Логин/пароль, если требуется HTTP-авторизация для доступа к выгрузке товаров
* Желаемое время обновления фида остатков (например, раз в 15 минут)

## Пример

```markup
<?xml version="1.0" encoding="utf-8" ?>
<inventory>
    <outlets>
        <outlet id="1">
            <name>Интернет магазин</name>
            <city />
            <address />
            <subway />
            <lat />
            <lon />
            <online>true</online>
        </outlet>
        <outlet id="2">
            <name>ТЦ Метрополис</name>
            <city>Москва</city>
            <address>Ленинградское ш., 16А, стр. 4</address>
            <subway>Войковская</subway>
            <lat>55.8225659</lat>
            <lon>37.4960903</lon>
            <online>false</online>
        </outlet>
        <outlet id="3">
            <name>Распределительный центр Москва и область</name>
            <city />
            <address />
            <subway />
            <lat />
            <lon />
            <online>true<online>
            <available geoId="d13945a8-7017-46ab-b1e6-ede1e89317ad">true</available>
        </outlet>
    <outlets>
    <availability>
        <product
            id="1267868123"
            xmlId="31573df4-ddf4-11e9-8a34-2a2ae2dbcce4"
            barcode="659849528550"
            outlet="1"
            quantity="9"
            price="999"
        />
        <product
            id="1267868123"
            barcode="659849528550"
            outlet="2"
            quantity="18"
        />
    </availability>
</inventory>
```

## Описание формата

### outlets -> outlet

Список магазинов

* **`id` (атрибут)** - идентификатор магазина
* **`name`** - название
* **`city`** - город (наименование города из ФИАС. Например "Москва" или "Санкт-Петербург")
* **`address`** - адрес
* **`subway`** - метро
* **`lat`** - широта
* **`lon`** - долгота
* **`online`** - является складом интернет-магазина (товары из этого склада доступны для доставки) (**`true`** или **`false`**)
* **`public`** - магазин отображается на виджете наличия на карточке товара (необязательный параметр. по умолчанию **`true`**)
* **`available`** - Отображается в каталоге определенного региона/города/населенного пункта (**`true`** доступно к покупке в этом регионе).
  * **`geoId`=** [ФИАС](https://www.alta.ru/fias/) идентификатор населенного пункта / области / региона в которые осуществляется продажа из этого магазина.

### availability -> product

Описание наличия одного товара для каждого магазина. Все свойства передаются как атрибуты.

{% hint style="warning" %}
Даже если товара нет в наличии в магазине, рекомендуем передать запись для товара и магазина, с **`quantity`** равным **`0`**
{% endhint %}

* **`id`** - идентификатор товарного предложения (**`id`** из YML фида)
* **`xmlId`** (опционально) - идентификатор товара во внешней системе учета наличия на складах (например в 1С)
* **`barcode`** (опционально) - штрих-код
* **`outlet`** - идентификатор магазина из **`outlets -> outlet`**
* **`quantity`** - количество товаров в наличии в этом магазине
