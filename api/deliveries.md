# Доставки

{% hint style="info" %}
Для подключения webhook расчета доставок, обратитесь к вашему менеджеру в IMSHOP.IO
{% endhint %}

IMSHOP.IO позволяет при помощи webhook подключить уже существующие на вашей стороне интеграции доставок.

{% hint style="info" %}
Этот запрос будет делаться каждый раз, когда необходимо получить список доступных способов доставки. Например во время оформления заказа.
{% endhint %}

## Формат запроса и пример

### Пример

```javascript
{
    "externalUserId": "XXXXXX",
    "country": "RU",
    "city": "Москва",
    "address": "ул Тестовая, д 1",
    "promocode": null,
    "addressData": {
        "city": "Москва",
        "region": "Москва",
        "street": "Тестовая",
        "house": "1",
        "building": null,
        "apt": null,
        "zip": "127001",
        "kladr": "7700000000000",
        "city_kladr": "7700000000000",
        "fias_code": "77000000000000000000000",
        "fias_id": "0c5b2444-70a0-4932-980c-b4dc0d3f02b5"
    },
    "items": [
        {
            "name": "Тестовый товар 1",
            "id": "00a03026-412a-54fe-a9df-dcf9325f8618",
            "privateId": "3464",
            "configurationId": "3464",
            "price": 3735,
            "quantity": 1,
            "discount": 0,
            "subtotal": 3735
        },
        {
            "name": "Тестовый товар 2",
            "id": "605e0108-dc95-5dab-95a2-7f459da6aade",
            "privateId": "29117",
            "configurationId": "29117",
            "price": 14540,
            "quantity": 1,
            "discount": 0,
            "subtotal": 14540
        },
        {
            "name": "Тестовый товар 3",
            "id": "3ccd380e-1f40-5056-8a7a-ef6e8a9582b5",
            "privateId": "34607",
            "configurationId": "34607",
            "price": 5723,
            "quantity": 2,
            "discount": 0,
            "subtotal": 11446
        },
        {
            "name": "Тестовый товар 4",
            "id": "523036eb-b776-5795-b24b-0f224f2d8b17",
            "privateId": "6527",
            "configurationId": "6527",
            "price": 29336,
            "quantity": 1,
            "discount": 0,
            "subtotal": 29336,
            "variableParams": {
              "width": "30",
              "height": "10",
              "length": "60"
            }
        }
    ]
}
```

### Описание формата

* **`externalUserId`** - идентификатор покупателя на стороне клиента \(`null` если не известен, или новый покупатель\)
* **`country`** - ISO код страны
* **`city`** - стандартизированное имя города из системы ФИАС
* **`address`** - адрес в виде текста
* **`addressData`** - подробные данные об адресе доставки, включая идентификаторы из КЛАДР и ФИАС
* **`promocode`** - прикрепленный промокод в виде строки. `null` если промокод не был применен
* **`skipPickupLocations`** - если этот параметр передан, и он равен `true`, то в ответе достаточно передать только способ самовывоза, и не передавать все доступные точки получения заказа
* **`items`** - список товаров в корзине
  * **`id`** - идентификатор товара в IMSHOP.IO
  * **`configurationId`** - идентификатор товарного предложения в IMSHOP.IO
  * **`privateId`** - идентификатор товарного предложения в системе клиента
  * **`name`** - наименование,
  * **`price`** - цена товара за 1 позицию
  * **`quantity`** - количество
  * **`discount`** - скидка на всю позицию
  * **`subtotal`** - итого за позицию \(`subtotal` = \(`price` \* `quantity`\) - `discount`\)
  * **`variableParams`** - параметры товара, выбранные пользователем \(см. [Товар: цвета, размеры и другие характеристики](../sync/yml/tovar-cveta-razmery-i-drugie-kharakteristiki.md)\)

## Формат ответа и пример

### Описание формата

* **`deliveries`** - список доступных способов доставки
  * **`id`** - идентификатор
  * **`title`** - название
  * **`description`** - описание
  * **`type`** - тип \(`delivery`, `pickup` - доставка или самовывоз\)
  * **`price`** - минимальная цена
  * **`priceLabel`** - цена в свободной форме; приоритетнее поля `price`
  * **`min`** - минимальный срок доставки \(`0` - сегодня, `1` - завтра итд\)
  * **`max`** - \(опционально\) максимальный срок доставки \(`0` - сегодня, `1` - завтра итд\)
  * **`timeLabel`** - время доставки в виде текста \(отображается на экране выбора способа доставки\)
  * **`locations`** - список ПВЗ \(если `type` = `pickup` и требуется выбор пункта самовывоза, и в запросе не передан `skipPickupLocations` = `true`\)
    * **`id`** - идентификатор самовывоза
    * **`title`** - название
    * **`address`** - адрес
    * **`city`** - город
    * **`time`** - расписание / время работы
    * **`subway`** - ближайшая станция метро
    * **`mall`** - \(опционально\) название ТЦ, если не указывается в поле `title`
    * **`lat`** - широта для отображения на карте
    * **`lon`** - долгота для отображения на карте
    * **`price`** - цена доставки в этот ПВЗ
    * **`min`** - ожидаемое время доставки \(`0` - сегодня\)
    * **`timeLabel`** - время доставки в виде текста \(отображается на экране выбора пункта получения заказа и на экране описания пункта самовывоза\)

### Пример

```javascript
{
    "deliveries": [
        {
            "id": "regular",
            "title": "Доставка курьером",
            "description": "Доставка курьерской службой по города на следующий день",
            "type": "delivery",
            "price": 350,
            "min": 1,
            "timeLabel": "На следующий день"
        },
        {
            "id": "pickup",
            "title": "Самовывоз из магазина",
            "description": "Самовывоз заказа из магазина в день заказа",
            "type": "pickup",
            "price": 0,
            "min": 0,
            "timeLabel": "В день заказа",
            "locations": [{
                "id": "a0001",
                "title": "Гидропроект",
                "address": "Волоколамское шоссе 2",
                "city": "Москва",
                "time": "Каждый день с 10 до 22",
                "subway": "Сокол",
                "mall": "",
                "lat": "55.8078034",
                "lon": "37.5054127",
                "price": 0,
                "min": 0,
                "timeLabel": "Сегодня после 14:00"
            }]
        }
    ]
}
```

