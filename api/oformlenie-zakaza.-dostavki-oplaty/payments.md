# Оплаты

![&#x412;&#x44B;&#x431;&#x43E;&#x440; &#x441;&#x43F;&#x43E;&#x441;&#x43E;&#x431;&#x430; &#x43E;&#x43F;&#x43B;&#x430;&#x442;&#x44B; \(&#x441;&#x43B;&#x435;&#x432;&#x430; &#x2014; &#x43F;&#x43E;&#x448;&#x430;&#x433;&#x43E;&#x432;&#x43E;&#x435; &#x43E;&#x444;&#x43E;&#x440;&#x43C;&#x43B;&#x435;&#x43D;&#x438;&#x435; &#x437;&#x430;&#x43A;&#x430;&#x437;&#x430;, &#x441;&#x43F;&#x440;&#x430;&#x432;&#x430; &#x2014; &#x43D;&#x430; &#x43E;&#x434;&#x43D;&#x43E;&#x439; &#x441;&#x442;&#x440;&#x430;&#x43D;&#x438;&#x446;&#x435;\)](../../.gitbook/assets/payments.png)

{% hint style="info" %}
Для подключения вебхука оплат обратитесь к вашему менеджеру в IMSHOP.IO
{% endhint %}

IMSHOP.IO передаёт выбранный способ доставки \(id\), состав корзины, город \(и страну\), а также промокод и идентификатор пользователя, если они есть; в ответ IMSHOP.IO ожидает список доступных способов оплаты.

{% hint style="warning" %}
Этот запрос отправляется не только в тех случаях, когда список доставок нужно вывести пользователю. Список доступных способов оплаты также нужен \(повторно\) перед финальным запросом оформления заказа.
{% endhint %}

## Формата запроса и пример

### Пример

**`POST`**`https://api-imshop.store.ru/v1/payments`

```javascript
{
    "externalUserId": "XXXXXX",
    "country": "RU",
    "city": "Москва",
    "promocode": null,
    "deliveryId": "14",
    "pickupLocationId": "100",
    "items": [
        {
            "name": "Тестовый товар 1",
            "id": "00a03026-412a-54fe-a9df-dcf9325f8618",
            "privateId": "3464",
            "configurationId": "3464",
            "quantity": 1
        },
        {
            "name": "Тестовый товар 2",
            "id": "605e0108-dc95-5dab-95a2-7f459da6aade",
            "privateId": "29117",
            "configurationId": "29117",
            "quantity": 1
        }
    ]
}
```

### Описание формата

* **`externalUserId`** — идентификатор покупателя на стороне клиента, если тот авторизован в мобильном приложении, `null` по умолчанию
* **`country`** — ISO код страны, `RU`
* **`city`** — стандартизированное имя города из системы ФИАС \(или UUID ФИАС, в зависимости от настроек\)
* **`promocode`** — прикрепленный промокод в виде строки, `null` по умолчанию
* **`deliveryId`** — идентификатор выбранного способа доставки, см. «[Доставки](deliveries.md)»
* **`pickupLocationId`** — выбранный пункт получения заказа, см. «[Доставки](deliveries.md)» \(`null`, если доставка или не подразумевает выбора ПВЗ\)
* **`items`** — список товаров в корзине
  * **`id`** — идентификатор товара в IMSHOP.IO
  * **`configurationId`** — идентификатор товарного предложения в системе клиента \(идентификатор из фида\)
  * **`privateId`** — идентификатор товара в системе клиента \(`group_id` из фида\)
  * **`quantity`** — количество

{% hint style="warning" %}
В запросе может приходить гораздо больше информации. Например, для товаров могут приходить названия. 

Дополнительные поля могут облегчить процесс отладки, но не являются частью спецификации, на них нельзя базировать программную логику.
{% endhint %}

## Ответ

{% hint style="info" %}
**Обяз**. — обязательное поле.
{% endhint %}

### Описание формата

* **`payments`** — список доступных способов оплаты
  * **`id`** — идентификатор, строка, **обяз**.
  * **`title`** — название, строка, **обяз**.
  * **`description`** — описание, строка
  * **`type`** — тип из перечисленных, **обяз**.:
    * `cash` - оплата наличнами
    * `card_on_delivery` - картой курьеру или при получении
    * `card` - картой в приложении
    * `iOS` - Apple Pay
    * `android` - Google Pay \(в разработке\)

### Пример

```javascript
{
    "payments": [
        {
            "id": "13",
            "title": "Оплата наличными при получении",
            "description": "Оплата наличными курьеру при получении заказа",
            "type": "cash"
        },
        {
            "id": "001",
            "title": "Картой в приложении",
            "description": "Оплата картой visa или mastercard в приложении",
            "type": "card"
        }
    ]
}
```

