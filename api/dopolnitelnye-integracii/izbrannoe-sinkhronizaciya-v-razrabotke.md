# Избранное - синхронизация \*в разработке

{% hint style="danger" %}
Дополнительные интеграции вводятся в эксплуатацию после завершения основных интеграций:

* [Оформление заказа](../oformlenie-zakaza.-dostavki-oplaty/order.md)
* [Доставки](../oformlenie-zakaza.-dostavki-oplaty/deliveries.md)
* [Оплаты](../oformlenie-zakaza.-dostavki-oplaty/payments.md)

Для подключения дополнительных интеграций обратитесь к вашему менеджеру в IMSHOP.IO
{% endhint %}

## Запрос

`APP SERVER → INFRASTRUCTURE`

{% hint style="info" %}
От вас потребуется URL, на который наш сервер будет слать **POST**-запрос. Да, мы _запрашиваем_ данные через _POST_, а не через _GET_.

Следует помнить, что этот запрос будет приходить из нашего доверенного, [авторизованного](../general.md#avtorizaciya-api) сервера; это — не публичный API.
{% endhint %}

В вашу систему будут приходить вот такие данные:

```javascript
{
    "userIdentifier": "12345",
    "lastSyncDate": 1644419057514,
    "itemIds": ["312", "443", "998"]
}
```

* `userIdentifier` — идентификатор пользователя (обязательное поле), полученный от системы клиента на этапе авторизации
* `lastSyncDate` - это timestamp, время последней синхронизации (в миллисекундах) избранного. Если приходит **0 (ноль)**, то это означает что пользователь ничего не добавлял в избранное пока был неавторизован.
* `itemIds` - список c id **** товаров

### Ответ

```javascript
{
   "lastSyncDate": 1644419090000,
   "itemIds": ["312", "443"]
}
```

При реализации этой фичи мы ожидаем что вы:

1. Добавите новое поле к примеру тоже **lastSyncDate** в базу данных с записями избранного пользователей и значение по умолчанию поставите **0**
2. При любом изменении избранного пользователя в базе данных, должны будете обновить поле **lastSyncDate** на текущий **timestamp** (время в миллисекундах)
3. При **запросе** от нас вы должны будете сравнивать две **даты,** которая **пришла** в запросе и которая хранится **у вас** в базе данных, в случае если дата в запросе **свежее,** то необходимо **заменить** весь состав избранных товаров в вашей базе данных из **нашего** **запроса** и **** обновить **** поле **lastSyncDate** на то которое пришло из нашего **запроса,** а если же дата из **вашей** базы данных окажется **свежее,** то вы должны будете **отправить** то состояние избранного которое в **вашей** базе данных. Если же **даты** **равные,** то все отлично и ваш ответ будет точно таким же как и наш запрос **.** Если мы отправили **0** и у вас **0**, то вам необходимо провести **слияние** (merge) нашего и вашего списка товаров и обновить поле **lastSyncDate** на текущий **timestamp** (время в миллисекундах)
