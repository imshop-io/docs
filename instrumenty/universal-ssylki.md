# Universal ссылки

Universal ссылки позволяют при переходе по обычной ссылке на сайт открывать товар сразу в приложении, если оно установлено.&#x20;

{% hint style="warning" %}
Обратите внимание, что открывается выбранный пользователем товар, а не категория.
{% endhint %}

Universal links работают в мессенджерах (whatsapp, telegram, facebook, vk, imessage), SMS и даже в браузере и поисковой выдаче. Например, если ваш покупатель найдет товар в Google, то при нажатии на ссылку в выдаче откроется сразу товар в приложении. Если приложении не установлено, то откроется вебсайт в обычном режиме со смарт-баннером на установку приложения

{% hint style="danger" %}
Если в ссылках используются **UTM-метки, обратитесь к product менеджеру** для их настройки&#x20;
{% endhint %}

## Установка

### Передайте ссылки на товары в фиде

В товарном YML-фиде должны быть переданы корректные ссылки на товары внутри тега **`<url>`**` ```&#x20;

Ссылки не должны содержать лишних GET  / query параметров (например недопустимо передавать UTM метки, идентификаторы сессий итд в фиде).

### Загрузите файлы подтверждения на сайт

#### iOS

* Получите у вашего менеджера в IMSHOP.IO идентификатор приложения для Universal ссылок (appID)
* В следующем шаблоне замените appID, на полученный от менеджера IMSHOP.IO и сделайте этот файл доступным по адресу https://www.вашсайт.ru/.well-known/apple-app-site-association

```javascript
{
  "applinks": {
    "apps": [],
    "details": [
      {
        "appID": "XXXXXXXXXX.ru.yourapp.ios",
        "paths": [
          "*"
        ]
      }
    ]
  }
}
```

#### Android

* Получите у вашего менеджера в IMSHOP.IO идентификатор android приложения для universal links (package\_name) и sha256 подпись (sha256\_cert\_fingerprints)
*   В следующем шаблоне замените package\_name и sha256\_cert\_fingerprints, на полученные от менеджера IMSHOP.IO и сделайте этот файл доступным по адресу https://www.вашсайт.ru/.well-known/assetlinks.json

    ```javascript
    [{
      "relation": ["delegate_permission/common.handle_all_urls"],
      "target": {
        "namespace": "android_app",
        "package_name": "ru.yourapp.android",
        "sha256_cert_fingerprints":
        ["00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00"]
      }
    }]
    ```

{% hint style="warning" %}
Внимание! файлы обязательно должны быть доступны именно по следующим URL, другие URL не поддерживаются iOS / Android

iOS: https://www.вашсайт.ru/.well-known/apple-app-site-association

Android: https://www.вашсайт.ru/.well-known/assetlinks.json
{% endhint %}

{% hint style="success" %}
Больше информации о Universal links [тут](https://habr.com/ru/post/423315/)
{% endhint %}

**Примечательные факты и советы**

* Universal Links не работает из браузера, при переходе на требуемый URL в Safari Вам покажет плашку, сообщающую что вы можете перейти в приложение.
* Universal Links не работает в цепочках редиректов (перенаправлений). При попадании на нужный URL сайт просто покажет вверху плашку, сообщающую о том, что вы можете перейти в приложение.
* Universal Links можно тестировать без собственного выделенного или виртуального сервера с помощью GitHub Pages.
* URL для перехода обязательно должен начинаться на «https://».
* Проверять всё ли в порядке с файлом apple-app-site-association можно через [App Search API Validation Tool](https://search.developer.apple.com/appsearch-validation-tool/).
* Чтобы вызвать переход в приложение с нужного URL не обязательно иметь какое-либо наполнение по этому URL. То-есть переход будет осуществлен даже если браузер по этому URL выдаёт 404.
* Долгое нажатие на Universal Link в приложении почты предложит Вам выбрать между открытием приложения и открытием браузера.
